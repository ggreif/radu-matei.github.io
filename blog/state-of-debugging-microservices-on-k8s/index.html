<!DOCTYPE HTML>

<html>
    <head>
        
            
                <title>The state of debugging microservices on Kubernetes</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.52-DEV" />
        


        
            <meta name="author" content="Radu Matei">
        
        
            <meta name="description" content="What is the state of remote debugging microservices on Kubernetes? How do most people solve their issues, what tools do they use and how can we make this easier?">
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="The state of debugging microservices on Kubernetes"/>
<meta name="twitter:description" content="What is the state of remote debugging microservices on Kubernetes? How do most people solve their issues, what tools do they use and how can we make this easier?"/>
<meta name="twitter:site" content="@matei_radu"/>

        <meta property="og:title" content="The state of debugging microservices on Kubernetes" />
<meta property="og:description" content="What is the state of remote debugging microservices on Kubernetes? How do most people solve their issues, what tools do they use and how can we make this easier?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://radu-matei.com/blog/state-of-debugging-microservices-on-k8s/" /><meta property="article:published_time" content="2018-05-05T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2018-05-05T00:00:00&#43;00:00"/>

        
<meta itemprop="name" content="The state of debugging microservices on Kubernetes">
<meta itemprop="description" content="What is the state of remote debugging microservices on Kubernetes? How do most people solve their issues, what tools do they use and how can we make this easier?">


<meta itemprop="datePublished" content="2018-05-05T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2018-05-05T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1836">



<meta itemprop="keywords" content="" />

        

        

        
        
            
        

        
        
            <link rel="stylesheet" href="/css/google-font.css" />
            <link rel="stylesheet" href="/css/font-awesome.min.css" />
            <link rel="stylesheet" href="/css/main.css" />
            <link rel="stylesheet" href="/css/add-on.css" />
            <link rel="stylesheet" href="/css/monokai-sublime.css">
        

        

        
        
        
            
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-81142224-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

        
    </head>
    <body>

        
        <div id="wrapper">

    
    
<header id="header">
    
    <h2><a href="/">Radu M</i></a></h2>
    

    <nav class="links">
        <ul>
            
            
            
            <li>
                <a href="/blog" >
                    
                    <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                </a>
            </li>
            
            
            
            <li>
                <a href="/about" >
                    
                    <i class="fa fa-smile-o">&nbsp;</i>About
                </a>
            </li>
            
            
            
            <li>
                <a href="/speaking" >
                    
                    <i class="fa fa-comments-o">&nbsp;</i>Speaking
                </a>
            </li>
            
            
            
            <li>
                <a href="/contact" >
                    
                    <i class="fa fa-envelope-o">&nbsp;</i>Contact
                </a>
            </li>
            
            
            
            <li>
                <a href="https://github.com/radu-matei"  target="_blank" >
                    
                    <i class="fa fa-github">&nbsp;</i>Open Source
                </a>
            </li>
            
            
            
            <li>
                <a href="https://twitter.com/matei_radu"  target="_blank" >
                    
                    <i class="fa fa-twitter">&nbsp;</i>Tweets
                </a>
            </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="q" value="site:https://radu-matei.com">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
    <section>
        <form class="search" method="get" action="//google.com/search">
            <input type="text" name="q" placeholder="Search" />
            <input type="hidden" name="q" value="site:https://radu-matei.com">
        </form>
    </section>

    
    <section>
        <ul class="links">
            
            
            
            <li>
                <a href="/blog" >
                    <h3>
                        
                        <i class="fa fa-newspaper-o">&nbsp;</i>
                        
                        Blog
                    </h3>
                </a>
            </li>
            
            
            
            <li>
                <a href="/about" >
                    <h3>
                        
                        <i class="fa fa-smile-o">&nbsp;</i>
                        
                        About
                    </h3>
                </a>
            </li>
            
            
            
            <li>
                <a href="/speaking" >
                    <h3>
                        
                        <i class="fa fa-comments-o">&nbsp;</i>
                        
                        Speaking
                    </h3>
                </a>
            </li>
            
            
            
            <li>
                <a href="/contact" >
                    <h3>
                        
                        <i class="fa fa-envelope-o">&nbsp;</i>
                        
                        Contact
                    </h3>
                </a>
            </li>
            
            
            
            <li>
                <a href="https://github.com/radu-matei"  target="_blank" >
                    <h3>
                        
                        <i class="fa fa-github">&nbsp;</i>
                        
                        Open Source
                    </h3>
                </a>
            </li>
            
            
            
            <li>
                <a href="https://twitter.com/matei_radu"  target="_blank" >
                    <h3>
                        
                        <i class="fa fa-twitter">&nbsp;</i>
                        
                        Tweets
                    </h3>
                </a>
            </li>
            
        </ul>
    </section>

    
    <section>
        <ul class="links">
            <header>
                <h3>Recent Posts</h3>
            </header>
            
            
            

            
            <li>
                <a href="https://radu-matei.com/blog/filter-k8s-logs/">
                    <p>Filter secrets from Kubernetes logs</p>
                </a>
            </li>
            
            <li>
                <a href="https://radu-matei.com/blog/state-of-debugging-microservices-on-k8s/">
                    <p>The state of debugging microservices on Kubernetes</p>
                </a>
            </li>
            
            <li>
                <a href="https://radu-matei.com/blog/debug-helm-tiller/">
                    <p>Debug Helm and Tiller using VS Code and Draft</p>
                </a>
            </li>
            
            <li>
                <a href="https://radu-matei.com/blog/real-world-draft/">
                    <p>Using Draft to develop front-end &#43; back-end applications. Experimenting with Draft, VS Code and remote debugging.</p>
                </a>
            </li>
            
            <li>
                <a href="https://radu-matei.com/blog/kube-toolkit/">
                    <p>kube-toolkit: Toolkit for creating gRPC-based CLI tools for Kubernetes, written in Go</p>
                </a>
            </li>
            
        </ul>
    </section>

    
    
</section>
    <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa fa-smile-o"></i></h3>
            </header>
            


<li><a href="//twitter.com/share?url=https%3a%2f%2fradu-matei.com%2fblog%2fstate-of-debugging-microservices-on-k8s%2f&text=The%20state%20of%20debugging%20microservices%20on%20Kubernetes&via=matei_radu" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
</a></li>


<li><a href="//plus.google.com/share?url=https%3a%2f%2fradu-matei.com%2fblog%2fstate-of-debugging-microservices-on-k8s%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
</a></li>


<li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fradu-matei.com%2fblog%2fstate-of-debugging-microservices-on-k8s%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
</a></li>


<li><a href="//reddit.com/submit?url=https%3a%2f%2fradu-matei.com%2fblog%2fstate-of-debugging-microservices-on-k8s%2f&title=The%20state%20of%20debugging%20microservices%20on%20Kubernetes" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
</a></li>


<li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fradu-matei.com%2fblog%2fstate-of-debugging-microservices-on-k8s%2f&title=The%20state%20of%20debugging%20microservices%20on%20Kubernetes" target="_blank" class="share-btn linkedin">
    <i class="fa fa-linkedin"></i>
    <p>LinkedIn</p>
</a></li>


<li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fradu-matei.com%2fblog%2fstate-of-debugging-microservices-on-k8s%2f&title=The%20state%20of%20debugging%20microservices%20on%20Kubernetes" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
</a></li>


<li><a href="mailto:?subject=Check out this post by Radu%20Matei&body=https%3a%2f%2fradu-matei.com%2fblog%2fstate-of-debugging-microservices-on-k8s%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
</a></li>

        </ul>
    </section>
</section>

    
    <div id="main">
        
        
        <article class="post">
    <header>
    <div class="title">
        
            <h1><a href="https://radu-matei.com/blog/state-of-debugging-microservices-on-k8s/">The state of debugging microservices on Kubernetes</a></h1>
            
        
        
            <p>What is the state of remote debugging microservices on Kubernetes? How do most people solve their issues, what tools do they use and how can we make this easier?</p>
        
    </div>
    <div class="meta">
        
            
        

        <time class="published"
            datetime='2018-05-05'>
            May 5, 2018</time>
        <span class="author">Radu Matei</span>
        
            <p>9 minute read</p>
        
        
    </div>
</header>


    <section id="social-share">
        <ul class="icons">
            


<li><a href="//twitter.com/share?url=https%3a%2f%2fradu-matei.com%2fblog%2fstate-of-debugging-microservices-on-k8s%2f&text=The%20state%20of%20debugging%20microservices%20on%20Kubernetes&via=matei_radu" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
</a></li>


<li><a href="//plus.google.com/share?url=https%3a%2f%2fradu-matei.com%2fblog%2fstate-of-debugging-microservices-on-k8s%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
</a></li>


<li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fradu-matei.com%2fblog%2fstate-of-debugging-microservices-on-k8s%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
</a></li>


<li><a href="//reddit.com/submit?url=https%3a%2f%2fradu-matei.com%2fblog%2fstate-of-debugging-microservices-on-k8s%2f&title=The%20state%20of%20debugging%20microservices%20on%20Kubernetes" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
</a></li>


<li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fradu-matei.com%2fblog%2fstate-of-debugging-microservices-on-k8s%2f&title=The%20state%20of%20debugging%20microservices%20on%20Kubernetes" target="_blank" class="share-btn linkedin">
    <i class="fa fa-linkedin"></i>
    <p>LinkedIn</p>
</a></li>


<li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fradu-matei.com%2fblog%2fstate-of-debugging-microservices-on-k8s%2f&title=The%20state%20of%20debugging%20microservices%20on%20Kubernetes" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
</a></li>


<li><a href="mailto:?subject=Check out this post by Radu%20Matei&body=https%3a%2f%2fradu-matei.com%2fblog%2fstate-of-debugging-microservices-on-k8s%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
</a></li>

        </ul>
    </section>
    
    

    
        
        




    


        

        <a href="https://radu-matei.com/blog/state-of-debugging-microservices-on-k8s/" class="image featured">
            <img src="/img/article-photos/state-of-debugging-microservices-on-k8s//GopherKubernetes.png" alt="" />
        </a>
    


    <div id="content">
        

<blockquote>
<p>Credit for the image goes to <a href="https://github.com/ashleymcnamara/gophers" target="_blank">Ashley McNamara&rsquo;s awesome Gopher collection</a></p>
</blockquote>

<h3 id="where-are-we-how-did-we-get-here">Where are we? How did we get here?</h3>

<p>For as long as we have been writing software, we have also introduced bugs in our applications. Back when we were developing monoliths, we could simply start the IDE of choice, add a couple of breakpoints, step through the code and <em>hopefully</em> solve the issue. There was a single place where the application was running, where logs were visible and where the application could be diagnosed.</p>

<blockquote>
<p>Everyone knows that debugging is twice as hard as writing a program in the first place. So if you&rsquo;re as clever as you can be when you write it, how will you ever debug it? - <a href="https://www.amazon.com/Elements-Programming-Style-2nd/dp/0070342075" target="_blank">&ldquo;The Elements of Programming Style&rdquo;</a>, 2nd edition</p>
</blockquote>

<p>But for the most part, we&rsquo;re no longer writing monoliths, but microservices, with containers and Kubernetes as the clear platform of choice for developing and deploying them. And this has allowed us to break down incredibly complex solutions into smaller, easier to understand components, often written in multiple languages, with multiple teams independently contributing to different parts of the system, enabling true continuous delivery.</p>

<p>Having a distributed solution with that many moving parts (ingresses, services, deployments, pods, containers, secrets, external services and more) means that accurately pinpointing a problem becomes significantly harder - and as a community, we have been developing really great tools for externalized and centralized logging, metrics and tracing, with the appearance of so many service mesh projects (Istio, Linkerd, Envoy, Conduit and many others) giving us articles such as - <a href="https://thenewstack.io/which-service-mesh-should-i-use/" target="_blank">Which service mesh should I use?</a></p>

<p>When we identify a service as not working properly, we start our journey by first restarting the pods, hoping this will fix the issue.</p>




    
    
        
        
        
            
        
        
            
        
    

    
    
    

    
    




    


    

    
        <p><span class="image center-image">
            <img src="/img/article-photos/state-of-debugging-microservices-on-k8s/turning-off.gif" alt="Turning off" />
        </span></p>
    



<p>When that doesn&rsquo;t work, we proceed to adding a bunch of print statements in our code, rebuild the container image, push it to a registry, then update the deployment manifest with the new tag.
With the new information, we proceed to making a few changes, rebuild and push the image, update the deployment&rsquo;s image tag and hope for the best. Repeat until the problem goes away.</p>

<p><a href="https://www.javaworld.com/article/2074974/learn-java/are-you-still-using-print-statements-for-debugging-.html" target="_blank">This article from 2001 - Are you still using print statements for debugging? There are more effective ways to debug your Java code</a> - pointed out how there were better ways of debugging. Yet in 2018, we&rsquo;re forced to use the same technique that was considered outdated seventeen years ago! Don&rsquo;t we have any better solutions?</p>

<h3 id="popular-debugging-solutions-on-kubernetes">Popular debugging solutions on Kubernetes</h3>

<blockquote>
<p>There are existing cloud-hosted services that support debugging - but in this article we&rsquo;re interested in open-source solutions that run on any Kubernetes cluster. Both Google and Microsoft have services in preview that allow the users of their managed Kubernetes cluster to attach a debugger:</p>

<ul>
<li><a href="http://landinghub.visualstudio.com/devspaces" target="_blank">Announcement of Azure Dev Spaces for Kubernetes</a></li>
<li><a href="https://cloud.google.com/debugger/docs/quickstart" target="_blank">How to use the Stackdriver debugger on Google Cloud Platform</a></li>
</ul>
</blockquote>

<p>One of the most popular open source projects in the space of remote debugging on Kubernetes is <a href="https://github.com/solo-io/squash" target="_blank">Squash</a>.</p>

<blockquote>
<p>Squash brings the power of modern popular debuggers to developers of microservices apps that run on container orchestration platforms. Squash bridges between the orchestration platform (without changing it) and IDE. Users are free to choose which containers, pods, services or images they are interested in debugging, and are allowed to set breakpoints in their codes, follow values of their variables on the fly, step through the code while jumping between microservices, and change these values during run time.</p>
</blockquote>

<p>The experience in <a href="https://www.youtube.com/watch?v=5TrV3qzXlgI" target="_blank">Idit&rsquo;s KubeCon Austin talk about Squash</a> is amazing! Being able to debug multiple microservices at the same time while stepping through code, evaluating expressions and variables is really awesome! However, the issue most people have with Squash is that <em>the Squash client shares the host PID namespace (and hence can see all processes on the node, making them available to be debugged).</em> Specifically, it means that you need to deploy (among other services) a Kubernetes <code>DaemonSet</code> that runs on each node, which is privileged and mounts the container runtime socket - here&rsquo;s the <a href="https://github.com/solo-io/squash/blob/master/contrib/kubernetes/squash-client.yml" target="_blank">Squash client deployment</a>.</p>

<p>While the technology is really awesome and beautifully put together, having a privileged service running on each node, able to see all processes on all nodes will turn some people away.</p>

<p>So what does it take to debug services on <em>any</em> Kubernetes cluster, without exposing all running processes on the cluster nodes?</p>

<h3 id="how-to-debug-applications-on-kubernetes">How to debug applications on Kubernetes</h3>

<p>Right now, to debug a Kubernetes service we need to:</p>

<ul>
<li>build the application for debugging (include the debugging symbols along with the binary)</li>
<li>create a container image (include the debugger) and push it to a container registry</li>
<li>update the Kubernetes manifest or Helm chart with the correct image tag, a debugger port exposed and the correct security context so the debugger can attach to a process inside your pod</li>
</ul>

<blockquote>
<p>This varies from language to language - in NodeJS simply start the process and pass the <code>--inspect</code> flag. For Golang, you need to have the <code>CAP_SYS_PTRACE</code> capability for the container running your debugger, so it can <code>ptrace</code> the application process.</p>

<p>Alternatively, you can directly start the process through the debugger, although this means a different process will be the main process in the container. You can also <code>exec</code> inside the container and start the debugging process before attaching the remote debugger - imperatively making changes to your containers means you no longer have immutable components, and replicating different behaviors becomes more difficult.</p>
</blockquote>

<ul>
<li>wait for a pod to be running</li>
<li>forward all application and debugger ports from your pod to <code>localhost</code></li>
<li>attach the local debugger to the remote target on the <code>localhost</code> port exposed by port forwarding</li>
</ul>

<p>Of course all the steps can be performed manually - and some people have been doing it, some more successfully than others. It is simply not viable to think people are willing to make all the steps manually.</p>

<p>Surely, there are existing tools that simplify parts of the experience:</p>

<ul>
<li><a href="https://github.com/vapor-ware/ksync" target="_blank">KSync</a> synchronizes the file system inside your container and works great with interpreted languages</li>
<li><a href="https://github.com/datawire/telepresence" target="_blank">Telepresence</a> redirects traffic from the cluster to your local machine</li>
<li><a href="https://github.com/Azure/draft" target="_blank">Draft</a> and <a href="https://github.com/GoogleContainerTools/skaffold" target="_blank">Skaffold</a> help with the process of consistently redeploying your application on each change.</li>
</ul>

<blockquote>
<p>For an introduction to the tools mentioned above, see <a href="https://www.youtube.com/watch?v=9YYeE-bMWv8&amp;list=PLvmPtYZtoXOENHJiAQc6HmV2jmuexKfrJ" target="_blank">Joe Beda&rsquo;s TGI Kubernetes series</a>.</p>
</blockquote>

<p>But taken independently, none of them provide an end-to-end experience to actually debugging multiple microservices in Kubernetes.
This is exactly what we&rsquo;re orchestrating with the <a href="https://github.com/Azure/vscode-kubernetes-tools" target="_blank">VS Code Kubernetes extension</a> and <a href="https://github.com/Azure/draft" target="_blank">Draft</a> - allowing us to enable the experience for <em>any</em> Kubernetes cluster, bringing the code editor - the place we&rsquo;re spending most of our time writing the application - back to a place where it has access to all components, logs, traces and break points and can initiate the debugging session through a single command.</p>

<p>For an early preview of what the experience feels like right now, here&rsquo;s the keynote demo from KubeCon Copenhagen 2018:</p>


<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="//www.youtube.com/embed/0sh2aWdfBxA" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>


<p>Here&rsquo;s what happened in the demo: using the VS Code Kubernetes extension, Helm and Draft, we are able to start two microservices, one written in Golang, one in NodeJS, create and push the container images, deploy them to Kubernetes using Helm, then attach the debuggers for Golang and NodeJS using VS Code. Then, as we make requests to our application, we can step through the NodeJS service, which creates requests to the Golang service - and we&rsquo;re able to debug that as well. Technically, we can chain as many services as we have in our system, although the the experience needs improvements on that (particularly on using a single VS Code instance).</p>

<blockquote>
<p>To see how debugging a real-world application looks like, <a href="https://radu-matei.com/blog/debug-helm-tiller/" target="_blank">here&rsquo;s how to use the same tools to debug Helm and Tiller.</a></p>
</blockquote>

<h3 id="well-how-should-we-debug-microservices-in-kubernetes">Well, how <em>should</em> we debug microservices in Kubernetes?</h3>

<p>Kubernetes 1.10 introduced an <a href="https://kubernetes.io/docs/tasks/configure-pod-container/share-process-namespace/" target="_blank">alpha-feature allowing us to share the process namespace between containers in a pod</a> - this means we can have the application in <code>containerA</code> and the debugger, with the exposed ports and security context in <code>containerB</code>.
The shared PID namespace is needed so that the debugger in <code>container B</code> can attach to a process in <code>containerA</code>, the application process, allowing us to have the <code>containerA</code> image very close (if not exactly the same as) to the production image.</p>

<blockquote>
<p>To enable feature gates in Kubernetes on Azure, you can use <a href="https://github.com/Azure/acs-engine/blob/master/examples/feature-gates/kubernetes-featuresgates.json" target="_blank"><code>acs-engine</code> with a cluster template</a> and pass the specific feature gate you need.</p>

<p>In Google Cloud Platform, you can use <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/alpha-clusters" target="_blank">Alpha clusters</a>.</p>

<p>It is generally not recommended to run Kubernetes alpha features in production, but for use only in short-lived testing clusters, due to increased risk of bugs and lack of long-term support.</p>
</blockquote>

<p>Once we have a cluster with Kubernetes 1.10 and <code>--feature-gates=PodShareProcessNamespace=true</code>, we can create a pod where we share the process namespace between the containers:</p>

<pre><code>apiVersion: v1
kind: Pod
metadata:
  name: &lt;your-pod&gt;
spec:
  shareProcessNamespace: true
  containers:
  - name: containerA
    image: &lt;your-application-image&gt;
  - name: containerB
    image: &lt;your-debugger-image&gt;
    securityContext:
      capabilities:
        add:
        - SYS_PTRACE
    ports:                              
    - containerPort: &lt;application-port&gt;
    - containerPort: &lt;debugging-port&gt;
</code></pre>

<blockquote>
<p>As mentioned earlier, some debuggers need to <code>ptrace</code> the process in order to successfully attach - some container runtimes disable by default the <code>SYS_PTRACE</code> capability, so we need to pass it to the container security context.</p>
</blockquote>

<p>Going for alpha in 1.11 is a feature used to <a href="https://github.com/kubernetes/community/blob/master/contributors/design-proposals/node/troubleshoot-running-pods.md" target="_blank">Troubleshoot Running Pods</a> - this will allow us to <strong>temporarily</strong> attach a container that has the debugger, the correct security context and the exposed ports for debugging - we then will attach the appropriate VS Code debugger, and when we&rsquo;re done, the container with the debugger will be killed.
This comes with all of the benefits above, plus our <code>container B</code> will only run temporarily, while the debugger is attached in our IDE, having exposed ports and elevated security contexts only for the duration of the debugging session.</p>

<pre><code>kubectl debug  --image=&lt;your-debugger-image&gt; &lt;your-application-pod&gt;
</code></pre>

<p>While this command is running we can start the debugging session, attach the debugger and understand the behavior of our application. When we disconnect the debugger, the container with the debugger will be killed, and our application returns to its normal. Imagine integrating this command in the regular <code>Start Debugging</code> workflow that we currently have with VS Code and Draft, and you have a pretty good idea of how the workflow will look in the not-so-distant future.</p>

<blockquote>
<p>Keep in mind that this feature is not yet released in Kubernetes, so probably the actual commands will change, but the end result should remain fairly similar.</p>
</blockquote>

<p>The biggest challenge is working towards having the debugging artifacts (container images and deployment manifests) as close to the production artifacts as possible. This will minimize the not so few cases where an issue appears in production but not in development, allowing us to attach debuggers to already running pods and, in extreme cases, even attach a debugger to a production pod (although, as previously mentioned, not advised).</p>

<h3 id="how-to-get-involved">How to get involved</h3>

<p>Give <a href="https://github.com/Azure/draft" target="_blank">Draft</a> and the <a href="https://github.com/Azure/vscode-kubernetes-tools" target="_blank">VS Code Kubernetes</a> extension a try!</p>

<p>While there are lots of things to be improved, the process of developing, debugging and deploying microservices on Kubernetes is getting easier, faster.</p>

    </div>
        

        
    <footer>
        <ul class="stats">
    
        

        
        
            <li>
                
                
                    

                    
                        Category
                    
                
            </li>
        
    

    
    
        <li><a href='/categories/kubernetes'>kubernetes</a></li>
    
</ul>

    </footer>
</article>
<ul class="actions pagination">
    
        <li><a href="https://radu-matei.com/blog/debug-helm-tiller/"
                class="button big previous">Debug Helm and Tiller using VS Code and Draft</a></li>
    

    
        <li><a href="https://radu-matei.com/blog/filter-k8s-logs/"
                class="button big next">Filter secrets from Kubernetes logs</a></li>
    
</ul>


<article class="post">
    <div id="disqus_thread"></div>


<script type="text/javascript">
    var disqus_shortname = 'radu-matei';
    var disqus_identifier = "https://radu-matei.com/blog/state-of-debugging-microservices-on-k8s/";
    var disqus_title = "The state of debugging microservices on Kubernetes";
    var disqus_url = "The state of debugging microservices on Kubernetes";

    var disqus_config = function () {
        this.page.url = "https://radu-matei.com/blog/state-of-debugging-microservices-on-k8s/";  
        this.page.identifier = "https://radu-matei.com/blog/state-of-debugging-microservices-on-k8s/"; 
    };

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</article>
    </div>
         
    
<section id="sidebar">

    
        <section id="intro">
            
            
                
                    <img src="/img/main/profile.jpg" class="intro-circle" width="150" alt="Radu" />
                
            
            
                <header>
                   <a href="/"> <h2>Radu M</h2></a>
                    <p>Kubernetes, containers and cloud native open-source developer tools. Debugging distributed systems. Software Engineer @Microsoft @Azure. Opinions are my own.</p>
                </header>
            
            <ul class="icons">
                
                
                    
<li><a href="//github.com/radu-matei" target="_blank" title="GitHub" class="fa fa-github"></a></li>



















<li><a href="//instagram.com/iamradum" target="_blank" title="Instagram" class="fa fa-instagram"></a></li>































<li><a href="//twitter.com/matei_radu" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>



<li><a href="mailto:radu@radu-matei.com" title="Email" class="fa fa-envelope"></a></li>


                
            </ul>
        </section>

    
        <section id="recent-posts">
            <ul class="posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                
                    
                

                
                    
                

                
                    <li>
                        <article>
                            <header>
                                <h3><a href="https://radu-matei.com/blog/filter-k8s-logs/">Filter secrets from Kubernetes logs</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2018-08-20'>
                                    August 20, 2018</time>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <h3><a href="https://radu-matei.com/blog/state-of-debugging-microservices-on-k8s/">The state of debugging microservices on Kubernetes</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2018-05-05'>
                                    May 5, 2018</time>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <h3><a href="https://radu-matei.com/blog/debug-helm-tiller/">Debug Helm and Tiller using VS Code and Draft</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2018-04-29'>
                                    April 29, 2018</time>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <h3><a href="https://radu-matei.com/blog/real-world-draft/">Using Draft to develop front-end &#43; back-end applications. Experimenting with Draft, VS Code and remote debugging.</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2018-04-10'>
                                    April 10, 2018</time>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <h3><a href="https://radu-matei.com/blog/kube-toolkit/">kube-toolkit: Toolkit for creating gRPC-based CLI tools for Kubernetes, written in Go</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2017-12-18'>
                                    December 18, 2017</time>
                            </header>
                        </article>
                    </li>
                

                
                    <li>
                        <ul class="actions">
                            <li><a href=
                            
                                /blog/
                            
                            class="button">View more posts</a></li>
                        </ul>
                    </li>
                
            </ul>
        </section>

    
    
    
    
        <section id="categories">
            <ul class="posts">
                <header>
                    <h3><a href="/categories/">Categories</a></h3>
                </header>

                
                    
                

                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/aspnet-core/">aspnet-core</a>
                                <span style="float:right;">11</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/kubernetes/">kubernetes</a>
                                <span style="float:right;">9</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/azure/">azure</a>
                                <span style="float:right;">7</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/docker/">docker</a>
                                <span style="float:right;">4</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/signalr/">signalr</a>
                                <span style="float:right;">4</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/dependency-injection/">dependency-injection</a>
                                <span style="float:right;">3</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/dotnet-core/">dotnet-core</a>
                                <span style="float:right;">2</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/draft/">draft</a>
                                <span style="float:right;">2</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/golang/">golang</a>
                                <span style="float:right;">2</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/helm/">helm</a>
                                <span style="float:right;">2</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/vscode/">vscode</a>
                                <span style="float:right;">2</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/websockets/">websockets</a>
                                <span style="float:right;">2</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/grpc/">grpc</a>
                                <span style="float:right;">1</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/iot/">iot</a>
                                <span style="float:right;">1</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/jenkins/">jenkins</a>
                                <span style="float:right;">1</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/windows-containers/">windows-containers</a>
                                <span style="float:right;">1</span>
                            </header>
                        </article>
                    </li>
                
            </ul>
        </section>
    

    
        

    
        <section id="footer">
            <ul class="icons">
                
                
                    
<li><a href="//github.com/radu-matei" target="_blank" title="GitHub" class="fa fa-github"></a></li>



















<li><a href="//instagram.com/iamradum" target="_blank" title="Instagram" class="fa fa-instagram"></a></li>































<li><a href="//twitter.com/matei_radu" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>



<li><a href="mailto:radu@radu-matei.com" title="Email" class="fa fa-envelope"></a></li>


                
            </ul>

            <p class="copyright">&copy; Radu Matei&#39;s Blog. Powered by <a href="//gohugo.io" target="_blank">Hugo</a></p>
        </section>

</section>

            </div>
        <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
        
        

        
        
            
        

        
        
            <script src="/js/jquery.min.js"></script>
            <script src="/js/skel.min.js"></script>
            <script src="/js/util.js"></script>
            <script src="/js/main.js"></script>
            <script src="/js/backToTop.js"></script>
            <script src="/js/highlight.pack.js"></script>
        

        

            
            <script>hljs.initHighlightingOnLoad();</script>
            

            
    </body>
</html>

