<!DOCTYPE HTML>

<html>
    <head>
        
            
                <title>ASP.NET Core MVC and SignalR Core</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.48-DEV" />
        


        
            <meta name="author" content="Radu Matei">
        
        
            
                <meta name="description" content="Radu Matei - Kubernetes, containers and cloud native open-source developer tools. Debugging distributed systems. Software Engineer @Microsoft @Azure. Opinions are my own.">
            
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ASP.NET Core MVC and SignalR Core"/>
<meta name="twitter:description" content="NOTICE This article is based on an old version of SignalR and is no longer functional / maintained - it is kept here only for historical purposes, you should visit this article that is current as of November / December 2017! All functionality of this article and much more can be found in the new article! 
Introduction In this article we will take a look at how to integrate ASP."/>
<meta name="twitter:site" content="@Matei_Radu"/>

        <meta property="og:title" content="ASP.NET Core MVC and SignalR Core" />
<meta property="og:description" content="NOTICE This article is based on an old version of SignalR and is no longer functional / maintained - it is kept here only for historical purposes, you should visit this article that is current as of November / December 2017! All functionality of this article and much more can be found in the new article! 
Introduction In this article we will take a look at how to integrate ASP." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://radu-matei.com/blog/aspnet-core-mvc-signalr/" /><meta property="article:published_time" content="2016-09-09T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2016-09-09T00:00:00&#43;00:00"/>
        
<meta itemprop="name" content="ASP.NET Core MVC and SignalR Core">
<meta itemprop="description" content="NOTICE This article is based on an old version of SignalR and is no longer functional / maintained - it is kept here only for historical purposes, you should visit this article that is current as of November / December 2017! All functionality of this article and much more can be found in the new article! 
Introduction In this article we will take a look at how to integrate ASP.">


<meta itemprop="datePublished" content="2016-09-09T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2016-09-09T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1755">



<meta itemprop="keywords" content="" />

        

        

        
        
            
        

        
        
            <link rel="stylesheet" href="/css/google-font.css" />
            <link rel="stylesheet" href="/css/font-awesome.min.css" />
            <link rel="stylesheet" href="/css/main.css" />
            <link rel="stylesheet" href="/css/add-on.css" />
            <link rel="stylesheet" href="/css/monokai-sublime.css">
        

        

        
        
        
            
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-81142224-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

        
    </head>
    <body>

        
        <div id="wrapper">

    
    
<header id="header">
    
        <h2><a href="/">Radu Matei</i></a></h2>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="/blog">
                        
                            <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                    </a>
                </li>
            
                <li>
                    <a href="/about">
                        
                            <i class="fa fa-smile-o">&nbsp;</i>About
                    </a>
                </li>
            
                <li>
                    <a href="/speaking">
                        
                            <i class="fa fa-comments-o">&nbsp;</i>Speaking
                    </a>
                </li>
            
                <li>
                    <a href="/contact">
                        
                            <i class="fa fa-envelope-o">&nbsp;</i>Contact
                    </a>
                </li>
            
                <li>
                    <a href="https://github.com/radu-matei">
                        
                            <i class="fa fa-github">&nbsp;</i>Open Source
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="q" value="site:https://radu-matei.com">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="q" value="site:https://radu-matei.com">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="/blog">
                            <h3>
                                
                                    <i class="fa fa-newspaper-o">&nbsp;</i>
                                
                                Blog
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/about">
                            <h3>
                                
                                    <i class="fa fa-smile-o">&nbsp;</i>
                                
                                About
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/speaking">
                            <h3>
                                
                                    <i class="fa fa-comments-o">&nbsp;</i>
                                
                                Speaking
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/contact">
                            <h3>
                                
                                    <i class="fa fa-envelope-o">&nbsp;</i>
                                
                                Contact
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://github.com/radu-matei">
                            <h3>
                                
                                    <i class="fa fa-github">&nbsp;</i>
                                
                                Open Source
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section>
            <ul class="links">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                
                    
                

                
                    <li>
                        <a href="https://radu-matei.com/blog/filter-k8s-logs/"><p>Filter secrets from Kubernetes logs</p></a>
                    </li>
                
                    <li>
                        <a href="https://radu-matei.com/blog/state-of-debugging-microservices-on-k8s/"><p>The state of debugging microservices on Kubernetes</p></a>
                    </li>
                
                    <li>
                        <a href="https://radu-matei.com/blog/debug-helm-tiller/"><p>Debug Helm and Tiller using VS Code and Draft</p></a>
                    </li>
                
                    <li>
                        <a href="https://radu-matei.com/blog/real-world-draft/"><p>Using Draft to develop front-end &#43; back-end applications. Experimenting with Draft, VS Code and remote debugging.</p></a>
                    </li>
                
                    <li>
                        <a href="https://radu-matei.com/blog/kube-toolkit/"><p>kube-toolkit: Toolkit for creating gRPC-based CLI tools for Kubernetes, written in Go</p></a>
                    </li>
                
            </ul>
        </section>

    
        
</section>

    <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa fa-smile-o"></i></h3>
            </header>
            


<li><a href="//twitter.com/share?url=https%3a%2f%2fradu-matei.com%2fblog%2faspnet-core-mvc-signalr%2f&text=ASP.NET%20Core%20MVC%20and%20SignalR%20Core&via=Matei_Radu" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
</a></li>


<li><a href="//plus.google.com/share?url=https%3a%2f%2fradu-matei.com%2fblog%2faspnet-core-mvc-signalr%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
</a></li>


<li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fradu-matei.com%2fblog%2faspnet-core-mvc-signalr%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
</a></li>


<li><a href="//reddit.com/submit?url=https%3a%2f%2fradu-matei.com%2fblog%2faspnet-core-mvc-signalr%2f&title=ASP.NET%20Core%20MVC%20and%20SignalR%20Core" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
</a></li>


<li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fradu-matei.com%2fblog%2faspnet-core-mvc-signalr%2f&title=ASP.NET%20Core%20MVC%20and%20SignalR%20Core" target="_blank" class="share-btn linkedin">
    <i class="fa fa-linkedin"></i>
    <p>LinkedIn</p>
</a></li>


<li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fradu-matei.com%2fblog%2faspnet-core-mvc-signalr%2f&title=ASP.NET%20Core%20MVC%20and%20SignalR%20Core" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
</a></li>


<li><a href="mailto:?subject=Check out this post by Radu%20Matei&body=https%3a%2f%2fradu-matei.com%2fblog%2faspnet-core-mvc-signalr%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
</a></li>

        </ul>
    </section>
</section>

    
    <div id="main">
        
        
        <article class="post">
    <header>
    <div class="title">
        
            <h1><a href="https://radu-matei.com/blog/aspnet-core-mvc-signalr/">ASP.NET Core MVC and SignalR Core</a></h1>
            
        
        
    </div>
    <div class="meta">
        
            
        

        <time class="published"
            datetime='2016-09-09'>
            September 9, 2016</time>
        <span class="author">Radu Matei</span>
        
            <p>9 minute read</p>
        
        
    </div>
</header>


    <section id="social-share">
        <ul class="icons">
            


<li><a href="//twitter.com/share?url=https%3a%2f%2fradu-matei.com%2fblog%2faspnet-core-mvc-signalr%2f&text=ASP.NET%20Core%20MVC%20and%20SignalR%20Core&via=Matei_Radu" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
</a></li>


<li><a href="//plus.google.com/share?url=https%3a%2f%2fradu-matei.com%2fblog%2faspnet-core-mvc-signalr%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
</a></li>


<li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fradu-matei.com%2fblog%2faspnet-core-mvc-signalr%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
</a></li>


<li><a href="//reddit.com/submit?url=https%3a%2f%2fradu-matei.com%2fblog%2faspnet-core-mvc-signalr%2f&title=ASP.NET%20Core%20MVC%20and%20SignalR%20Core" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
</a></li>


<li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fradu-matei.com%2fblog%2faspnet-core-mvc-signalr%2f&title=ASP.NET%20Core%20MVC%20and%20SignalR%20Core" target="_blank" class="share-btn linkedin">
    <i class="fa fa-linkedin"></i>
    <p>LinkedIn</p>
</a></li>


<li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fradu-matei.com%2fblog%2faspnet-core-mvc-signalr%2f&title=ASP.NET%20Core%20MVC%20and%20SignalR%20Core" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
</a></li>


<li><a href="mailto:?subject=Check out this post by Radu%20Matei&body=https%3a%2f%2fradu-matei.com%2fblog%2faspnet-core-mvc-signalr%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
</a></li>

        </ul>
    </section>
    

    <div id="content">
        

<h2 id="notice">NOTICE</h2>

<p><a href="https://radu-matei.com/blog/signalr-core" target="_blank"><strong>This article is based on an old version of SignalR and is no longer functional / maintained - it is kept here only for historical purposes, you should visit this article that is current as of November / December 2017! All functionality of this article and much more can be found in the new article!</strong> </a></p>

<h2 id="introduction">Introduction</h2>

<p>In this article we will take a look at how to integrate ASP.NET Core MVC with SignalR Core (at the moment of writing this article, the latest version of SignalR is <a href="https://dotnet.myget.org/feed/aspnetcore-ci-dev/package/nuget/Microsoft.AspNetCore.SignalR.Server" target="_blank"><code>0.2.0-alpha1-22107</code></a>) and how to use the SignalR context outside hubs (and solve the current issues with the custom resolvers that will be detailed later) to update clients.</p>

<blockquote>
<p>This article assumes a basic understanding of ASP.NET Core MVC and will not try to explain all concepts here. <a href="https://radu-matei.github.io/blog/aspnet-core-api/" target="_blank">This article</a> does an introduction to ASP.NET Core MVC and has the basic application structure needed for this article.</p>

<p>In order to get started with SignalR Core, <a href="https://radu-matei.github.io/blog/signalr-core/" target="_blank">take a look at this article</a>.</p>
</blockquote>

<p>We will build on <a href="https://radu-matei.github.io/blog/aspnet-core-api/" target="_blank">this application</a> and add real time functionality to it.</p>

<p>It is a very simple application that will enable the creation of posts (much like messages) and it took us through adding the MVC services, creating models, controllers and consuming some data. Now, we want all connected users to see in real time when somebody adds posts in the page without refreshing it.</p>

<h2 id="configure-the-application">Configure the application</h2>

<p>NuGet has the ability to get packages from more than one source, and we need it to download alpha packages that are only available on the MyGet server of the ASP.NET team, besides the ASP.NET Core packages available on NuGet. So in the root of the application add a file called <code>NuGet.Config</code> with the following content:</p>

<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;configuration&gt;
    &lt;packageSources&gt;
        &lt;clear/&gt;
            &lt;add key=&quot;aspnetcidev&quot; value=&quot;https://dotnet.myget.org/F/aspnetcore-ci-dev/api/v3/index.json&quot;/&gt;
            &lt;add key=&quot;api.nuget.org&quot; value=&quot;https://api.nuget.org/v3/index.json&quot;/&gt;
    &lt;/packageSources&gt;
&lt;/configuration&gt;
</code></pre>

<h2 id="add-the-required-packages">Add the required packages</h2>

<p>For this application, we will need the Kestrel web server (of course), the MVC packages so we can use controllers, static files so we can have HTML and JavaScript files served, SignalR and WebSockets:</p>

<pre><code>&quot;Microsoft.AspNetCore.Server.Kestrel&quot;: &quot;1.0.0&quot;,
&quot;Microsoft.AspNetCore.Mvc&quot;: &quot;1.0.0&quot;,
&quot;Microsoft.AspNetCore.StaticFiles&quot;: &quot;1.0.0&quot;,
&quot;Microsoft.AspNetCore.SignalR.Server&quot;: &quot;0.2.0-*&quot;,
&quot;Microsoft.AspNetCore.WebSockets&quot;: &quot;0.2.0-*&quot;
</code></pre>

<h2 id="program-cs"><code>Program.cs</code></h2>

<p>Besides adding the <code>UseContentRoot</code> statement, the <code>Main</code> method is pretty much standard for an ASP.NET Core application.</p>

<pre><code> public static void Main(string[] args)
 {
     var host = new WebHostBuilder()
         .UseKestrel()
         .UseContentRoot(Directory.GetCurrentDirectory())
         .UseStartup&lt;Startup&gt;()
         .Build();

     host.Run();
 }
</code></pre>

<h2 id="post-ipostrepository-and-postrepository"><code>Post</code>, <code>IPostRepository</code> and <code>PostRepository</code></h2>

<p><a href="https://radu-matei.github.io/blog/aspnet-core-api/" target="_blank">This article</a> explains all these components thoroughly, but let&rsquo;s see briefly what each one does:</p>

<pre><code>public class Post
{
    public int Id { get; set; }
    public string UserName { get; set; }
    public string Text { get; set; }

    public Post(int id, string userName, string text)
    {
        Id = id;
        UserName = userName;
        Text = text;
    }

    public Post()
    {
    }
}
</code></pre>

<p><code>Post</code> will be the model that users add in the application. It is a straightforward C# class with three auto-implemented properties and two constructors.</p>

<blockquote>
<p>Each user that enters can publish a post containing his user name and a text, so our Post class only contains two properties for the UserName and Text of the post and an Id.</p>
</blockquote>

<pre><code>using System.Collections.Generic;

public interface IPostRepository
{
    List&lt;Post&gt; GetAll();
    Post GetPost(int id);
    void AddPost(Post post);
}
</code></pre>

<blockquote>
<p>Regardless of where that data is going to be stored, there should be a consistent way of reading and writing, and we will achieve this through an interface, IPostRepository, that will expose the minimum necessary methods: a method to read all posts, a method to add a post and a method to retrieve a post with a specified id.</p>
</blockquote>

<pre><code>using System.Collections.Generic;
using System.Linq;

public class PostRepository : IPostRepository
{
    private List&lt;Post&gt; _posts = new List&lt;Post&gt;()
    {
        new Post(1, &quot;Obi-Wan Kenobi&quot;,&quot;These are not the droids you're looking for&quot;),
        new Post(2, &quot;Darth Vader&quot;,&quot;I find your lack of faith disturbing&quot;)
    };
    public void AddPost(Post post)
    {
        _posts.Add(post);
    }

    public List&lt;Post&gt; GetAll()
    {
        return _posts;
    }

    public Post GetPost(int id)
    {
        return _posts.FirstOrDefault(p =&gt; p.Id == id);
    }
}
</code></pre>

<blockquote>
<p>We implemented the <code>IPostRepository</code> interface through an in-memory class called <code>PostRepository</code> that holds the data in a list. Since we have the three methods to access the data, there is no need to expose the post list outside the class, so it is be private. Besides the list, we only need to implement the three methods from the interface.</p>
</blockquote>

<h2 id="the-postscontroller">The <code>PostsController</code></h2>

<pre><code>using System.Collections.Generic;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.SignalR.Infrastructure;

public class PostsController : Controller
{
    private IPostRepository _postRepository { get; set; }

    public PostsController(IPostRepository postRepository)
    {
        _postRepository = postRepository;
    }

    [HttpGet]
    public List&lt;Post&gt; GetPosts()
    {
        return _postRepository.GetAll();
    }

    [HttpGet]
    public Post GetPost(int id)
    {
        return _postRepository.GetPost(id);
    }

    [HttpPost]
    public void AddPost(Post post)
    {
        _postRepository.AddPost(post);
    }
}

</code></pre>

<p>From this controller, we will update all clients when a post was added using SignalR by getting the context of the hub and calling client methods  using a <code>ConnectionManager</code>. We will see later how to achieve this.</p>

<h2 id="add-a-hub">Add a hub</h2>

<p>In this application, we will use the hub as a proxy: clients will not call hub methods directly. SignalR will be used to provide server updates - that is the server notifies all clients that something happened, so the clients must first connect to a hub.</p>

<p>So the hub class will be incredibly simple:</p>

<pre><code>using Microsoft.AspNetCore.SignalR;

public class PostsHub : Hub
{
}
</code></pre>

<p>We will see how to use the hub context outside of the hub a little later.</p>

<h2 id="camel-case-issues-and-custom-contract-resolvers">Camel case issues and custom contract resolvers</h2>

<p>At this moment, MVC uses camel case notation to pass JSON to clients. That means that even if on the server you write your class properties with Pascal case notation (as you should!), JavaScript clients would get Camel cased objects.</p>

<p>This behavior is new to ASP.NET Core and was not present in the older versions when SignalR was used and built, so SignalR and its clients all expect Pascal case objects, while the objects passed between MVC and its clients are camel cased. This means we cannot reuse metods across the JavaScript client, thing we cannot tolerate.</p>

<p>So we are going to make SignalR pass objects in camel case. Basically, we are going to &ldquo;recycle&rdquo; <a href="https://github.com/SignalR/SignalR/issues/500#issuecomment-7453751" target="_blank">this old SignalR GitHub issue</a> and adapt it to our versions of ASP.NET and SignalR.</p>

<h2 id="add-a-custom-contract-resolvers">Add a custom contract resolvers</h2>

<p>A first try could be to change the default contract resolver to a <code>CamelCasePropertyNamesContractResolver()</code> inside the <code>ConfigureServices</code> method:</p>

<pre><code>var settings = new JsonSerializerSettings();
settings.ContractResolver = new CamelCasePropertyNamesContractResolver();

var serializer = JsonSerializer.Create(settings);
services.Add(new ServiceDescriptor(typeof(JsonSerializer), 
             provider =&gt; serializer, 
             ServiceLifetime.Transient));

</code></pre>

<p>While this is not far from what we are going to do, at this moment we simply cannot force all components to pass camel case objects because it would break current conventions in place.</p>

<p>Simply put, if you try this the JavaScript client will no longer connect, because all connection and internal communication is tansformed to camel case.</p>

<p>We are at the point where we need all of the application objects to be passed camel cased, and all connection and SignalR internal objects to be unmodified.</p>

<p>We will write a custom contract resolver that looks at the assembly of the object type and if it is not an internal SignalR object (if it is not from the same assembly as <code>Connection</code>, a class from SignalR), then it modifies it to be camel case:</p>

<pre><code>using System;
using System.Reflection;
using Microsoft.AspNetCore.SignalR.Infrastructure;
using Newtonsoft.Json.Serialization;

    public class SignalRContractResolver : IContractResolver
    {
        private readonly Assembly _assembly;
        private readonly IContractResolver _camelCaseContractResolver;
        private readonly IContractResolver _defaultContractSerializer;

        public SignalRContractResolver()
        {
            _defaultContractSerializer = new DefaultContractResolver();
            _camelCaseContractResolver = new CamelCasePropertyNamesContractResolver();
            _assembly = typeof(Connection).GetTypeInfo().Assembly;
        }


        public JsonContract ResolveContract(Type type)
        {
            if (type.GetTypeInfo().Assembly.Equals(_assembly))
                return _defaultContractSerializer.ResolveContract(type);

            return _camelCaseContractResolver.ResolveContract(type);
        }

    }

</code></pre>

<p>So in <code>ConfigureServices</code> we register our contract resolver very similarly to what we had earlier:</p>

<pre><code>var settings = new JsonSerializerSettings();
settings.ContractResolver = new SignalRContractResolver();

var serializer = JsonSerializer.Create(settings);
services.Add(new ServiceDescriptor(typeof(JsonSerializer), 
             provider =&gt; serializer, 
             ServiceLifetime.Transient));
</code></pre>

<blockquote>
<p>Note that most likely, this will be done more elegantly in future releases.</p>
</blockquote>

<h2 id="the-configure-method">The <code>Configure</code> method</h2>

<p>Again, the <code>Configure</code> method is pretty straightforward: we add static files support, configure MVC and add WebSockets and SignalR.</p>

<pre><code>    public void Configure(IApplicationBuilder app)
    {
        app.UseStaticFiles();

        app.UseMvc(routes =&gt; 
        {
            routes.MapRoute(
                    name: &quot;default&quot;,
                    template: &quot;api/{controller}/{action}/{id?}&quot;
            );
        });

        app.UseWebSockets();
        app.UseSignalR();
    }
</code></pre>

<h2 id="calling-client-methods-outside-hubs">Calling client methods outside hubs</h2>

<p>In the previous versions of SignalR, in order to call client methods and manage groups outside a hub you would need to make use of the <code>GlobalHost</code>, which is no longer available in the new version.</p>

<p>So we will use an instance of <code>ConnectionManager</code>, specifically the <code>GetHubContext&lt;&gt;()</code> method. We need to register this service so we can use it in the controller:</p>

<p><code>_connectionManager.GetHubContext&lt;PostsHub&gt;().someClientMethod(parameters)</code></p>

<h2 id="the-configureservices-method">The <code>ConfigureServices</code> method</h2>

<pre><code>    public void ConfigureServices(IServiceCollection services)
    {
        var settings = new JsonSerializerSettings();
        settings.ContractResolver = new SignalRContractResolver();

        var serializer = JsonSerializer.Create(settings);

        services.Add(new ServiceDescriptor(typeof(JsonSerializer), 
                     provider =&gt; serializer, 
                     ServiceLifetime.Transient));

        services.AddSingleton&lt;IPostRepository, PostRepository&gt;();

        services.AddSignalR(options =&gt; 
        {
            options.Hubs.EnableDetailedErrors = true;
        });
        
        services.AddMvc();
    }
</code></pre>

<p>We added the new contract resolver, we added the <code>PostRepository</code> and we added SignalR. Now we need to use it in the controller:</p>

<h2 id="the-updated-controller">The updated controller</h2>

<pre><code>using System.Collections.Generic;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.SignalR.Infrastructure;

public class PostsController : Controller
{
    private IPostRepository _postRepository { get; set; }
    private IConnectionManager _connectionManager {get; set; }

    public PostsController(IPostRepository postRepository, IConnectionManager connectionManager)
    {
        _postRepository = postRepository;
        _connectionManager = connectionManager;
    }

    [HttpGet]
    public List&lt;Post&gt; GetPosts()
    {
        return _postRepository.GetAll();
    }

    [HttpGet]
    public Post GetPost(int id)
    {
        return _postRepository.GetPost(id);
    }

    [HttpPost]
    public void AddPost(Post post)
    {
        _postRepository.AddPost(post);
        _connectionManager.GetHubContext&lt;PostsHub&gt;().Clients.All.publishPost(post);
    }
}
</code></pre>

<p>Every time someone adds a new post, all connected users will be notified and will call the <code>publishPost</code> method.</p>

<h2 id="the-client">The client</h2>

<p>The client will be exactly the same as in SignalR 2.2.x:</p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;

    &lt;script src=&quot;http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.2.0.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;http://ajax.aspnetcdn.com/ajax/signalr/jquery.signalr-2.2.0.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;/signalr/hubs&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    
    &lt;input id=&quot;userNameInput&quot; type=&quot;text&quot; placeholder=&quot;Enter your user name...&quot; /&gt;
    &lt;input id=&quot;textInput&quot; type=&quot;text&quot; placeholder=&quot;Enter your status...&quot; /&gt;

    &lt;button id=&quot;publishPostButton&quot;&gt;Publish post!&lt;/button&gt;

    &lt;ul id=&quot;postsList&quot;&gt;&lt;/ul&gt;
    
    &lt;script type=&quot;text/javascript&quot;&gt;
        $.ajax({
            url: '/api/Posts/GetPosts',
            method: 'GET',
            dataType: 'JSON',
            success: addPostsList
        });

        function addPostsList(posts) {
            $.each(posts, function (index) {
                var post = posts[index];
                addPost(post);
            });
        }

        function addPost(post) {
            $(&quot;#postsList&quot;).append(
                    '&lt;li&gt;&lt;b&gt;' + post.userName + '&lt;/b&gt;&lt;br&gt;' + post.text + '&lt;/li&gt;&lt;br&gt;'
                 );
        }

        var hub = $.connection.postsHub;

        hub.client.publishPost = addPost;

        $(&quot;#publishPostButton&quot;).click(function () {

            var post = {
                userName: $(&quot;#userNameInput&quot;).val() || &quot;Guest&quot;,
                text: $(&quot;#textInput&quot;).val()
            };
            $.ajax({
                url: '/api/Posts/AddPost',
                method: 'POST',
                data: post
            });
        });
        
        $.connection.hub.logging = true;
        $.connection.hub.start();
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>Now if you open two browser tabs and start adding messages, you can see all pages updating in real time.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In this article we saw how to use MVC Core and SignalR for providing real time data to users.</p>

<p>Since SignalR is still in alpha, at this moment there are some issues to be addressed and many breaking changes to come and I will try to keep this example up-to-date.</p>

    </div>
        

        
    <footer>
        <ul class="stats">
    
        

        
        
            <li>
                
                
                    

                    
                        Categories
                    
                
            </li>
        
    

    
    
        <li><a href='/categories/aspnet-core'>aspnet-core</a></li>
    
        <li><a href='/categories/azure'>azure</a></li>
    
        <li><a href='/categories/signalr'>signalr</a></li>
    
</ul>

    </footer>
</article>
<ul class="actions pagination">
    
        <li><a href="https://radu-matei.com/blog/aspnet-core-json-dependency-injection/"
                class="button big previous">Inject ASP.NET Core Dependencies from JSON files</a></li>
    

    
        <li><a href="https://radu-matei.com/blog/rpi-sensehat-telemetry/"
                class="button big next">Get started with Raspberry Pi3, Sense HAT and Azure IoT Suite</a></li>
    
</ul>


<article class="post">
    <div id="disqus_thread"></div>


<script type="text/javascript">
    var disqus_shortname = 'radu-matei';
    var disqus_identifier = "https://radu-matei.com/blog/aspnet-core-mvc-signalr/";
    var disqus_title = "ASP.NET Core MVC and SignalR Core";
    var disqus_url = "ASP.NET Core MVC and SignalR Core";

    var disqus_config = function () {
        this.page.url = "https://radu-matei.com/blog/aspnet-core-mvc-signalr/";  
        this.page.identifier = "https://radu-matei.com/blog/aspnet-core-mvc-signalr/"; 
    };

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</article>
    </div>
         
    
<section id="sidebar">

    
        <section id="intro">
            
            
                
                    <img src="/img/main/radu-matei-profile.jpg" class="intro-circle" width="100" alt="Radu Matei" />
                
            
            
                <header>
                   <a href="/"> <h2>Radu Matei</h2></a>
                    <p>Kubernetes, containers and cloud native open-source developer tools. Debugging distributed systems. Software Engineer @Microsoft @Azure. Opinions are my own.</p>
                </header>
            
            <ul class="icons">
                
                
                    
<li><a href="//github.com/radu-matei" target="_blank" title="GitHub" class="fa fa-github"></a></li>



































<li><a href="//linkedin.com/in/mateiradu" target="_blank" title="LinkedIn" class="fa fa-linkedin"></a></li>





<li><a href="//stackoverflow.com/users/3084239/radu-matei" target="_blank" title="Stack Overflow" class="fa fa-stack-overflow"></a></li>









<li><a href="//facebook.com/matei.radu94" target="_blank" title="Facebook" class="fa fa-facebook"></a></li>



<li><a href="//twitter.com/Matei_Radu" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>



<li><a href="mailto:radu@radu-matei.com" title="Email" class="fa fa-envelope"></a></li>


                
            </ul>
        </section>

    
        <section id="recent-posts">
            <ul class="posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                
                    
                

                
                    
                

                
                    <li>
                        <article>
                            <header>
                                <h3><a href="https://radu-matei.com/blog/filter-k8s-logs/">Filter secrets from Kubernetes logs</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2018-08-20'>
                                    August 20, 2018</time>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <h3><a href="https://radu-matei.com/blog/state-of-debugging-microservices-on-k8s/">The state of debugging microservices on Kubernetes</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2018-05-05'>
                                    May 5, 2018</time>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <h3><a href="https://radu-matei.com/blog/debug-helm-tiller/">Debug Helm and Tiller using VS Code and Draft</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2018-04-29'>
                                    April 29, 2018</time>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <h3><a href="https://radu-matei.com/blog/real-world-draft/">Using Draft to develop front-end &#43; back-end applications. Experimenting with Draft, VS Code and remote debugging.</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2018-04-10'>
                                    April 10, 2018</time>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <h3><a href="https://radu-matei.com/blog/kube-toolkit/">kube-toolkit: Toolkit for creating gRPC-based CLI tools for Kubernetes, written in Go</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2017-12-18'>
                                    December 18, 2017</time>
                            </header>
                        </article>
                    </li>
                

                
                    <li>
                        <ul class="actions">
                            <li><a href=
                            
                                /blog/
                            
                            class="button">View more posts</a></li>
                        </ul>
                    </li>
                
            </ul>
        </section>

    
    
    
    
        <section id="categories">
            <ul class="posts">
                <header>
                    <h3><a href="/categories/">Categories</a></h3>
                </header>

                
                    
                

                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/aspnet-core/">aspnet-core</a>
                                <span style="float:right;">11</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/kubernetes/">kubernetes</a>
                                <span style="float:right;">9</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/azure/">azure</a>
                                <span style="float:right;">7</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/docker/">docker</a>
                                <span style="float:right;">4</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/signalr/">signalr</a>
                                <span style="float:right;">4</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/dependency-injection/">dependency-injection</a>
                                <span style="float:right;">3</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/dotnet-core/">dotnet-core</a>
                                <span style="float:right;">2</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/draft/">draft</a>
                                <span style="float:right;">2</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/golang/">golang</a>
                                <span style="float:right;">2</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/helm/">helm</a>
                                <span style="float:right;">2</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/vscode/">vscode</a>
                                <span style="float:right;">2</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/websockets/">websockets</a>
                                <span style="float:right;">2</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/grpc/">grpc</a>
                                <span style="float:right;">1</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/iot/">iot</a>
                                <span style="float:right;">1</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/jenkins/">jenkins</a>
                                <span style="float:right;">1</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/windows-containers/">windows-containers</a>
                                <span style="float:right;">1</span>
                            </header>
                        </article>
                    </li>
                
            </ul>
        </section>
    

    
        

    
        <section id="footer">
            <ul class="icons">
                
                
                    
<li><a href="//github.com/radu-matei" target="_blank" title="GitHub" class="fa fa-github"></a></li>



































<li><a href="//linkedin.com/in/mateiradu" target="_blank" title="LinkedIn" class="fa fa-linkedin"></a></li>





<li><a href="//stackoverflow.com/users/3084239/radu-matei" target="_blank" title="Stack Overflow" class="fa fa-stack-overflow"></a></li>









<li><a href="//facebook.com/matei.radu94" target="_blank" title="Facebook" class="fa fa-facebook"></a></li>



<li><a href="//twitter.com/Matei_Radu" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>



<li><a href="mailto:radu@radu-matei.com" title="Email" class="fa fa-envelope"></a></li>


                
            </ul>

            <p class="copyright">&copy; Radu Matei&#39;s Blog. Powered by <a href="//gohugo.io" target="_blank">Hugo</a></p>
        </section>

</section>

            </div>
        <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
        
        

        
        
            
        

        
        
            <script src="/js/jquery.min.js"></script>
            <script src="/js/skel.min.js"></script>
            <script src="/js/util.js"></script>
            <script src="/js/main.js"></script>
            <script src="/js/backToTop.js"></script>
            <script src="/js/highlight.pack.js"></script>
        

        

            
            <script>hljs.initHighlightingOnLoad();</script>
            

            
    </body>
</html>

